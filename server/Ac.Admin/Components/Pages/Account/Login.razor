@page "/account/login"
@layout AuthLayout
@attribute [AllowAnonymous]

@inject NavigationManager Nav

<PageTitle>Вход — ActiveChat Admin</PageTitle>

<h5 class="text-center mb-4">Войти в систему</h5>

@if (Registered)
{
    <div class="alert alert-success small py-2">
        Аккаунт создан. Войдите.
    </div>
}

<p class="text-center text-muted small mb-4">
    Вход выполняется через центральный сервис авторизации (Ac.Auth).
</p>

<div class="d-flex justify-content-center">
    <a href="@LoginUrl" class="btn btn-primary">Войти через Ac.Auth</a>
</div>

<div class="mt-4 text-center small text-muted">
    <a href="/account/register" class="text-decoration-none">Создать аккаунт</a>
</div>

@code {
    [SupplyParameterFromQuery(Name = "registered")]
    private bool Registered { get; set; }

    [SupplyParameterFromQuery(Name = "returnUrl")]
    private string? ReturnUrl { get; set; }

    private string LoginUrl => string.IsNullOrEmpty(ReturnUrl)
        ? "/challenge-oidc"
        : $"/challenge-oidc?returnUrl={Uri.EscapeDataString(ReturnUrl)}";
}
